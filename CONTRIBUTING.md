# Contributing to This Project

Thank you for your interest in contributing! We appreciate your help in improving this project. Please follow the guidelines below to ensure a smooth collaboration.

 ## Summary of basic workflow
The basic workflow is

clone → create feature branch → push → open PR

The steps (which are described in more detail below) are

1. Clone the remote repo to create a local copy of the repo.

2. Create feature branch from latest ```main```

3. Work on your changes and test them locally.

4. Before opening a pull request (PR) rebase your feature branch onto the remote ```main``` branch:
```
git fetch origin
git rebase origin/main
```

5. Fix any conflicts which arise locally

6. Push updated feature branch to the remote repo.

7. Go to GitHub.com and open the PR proposing to merge your feature branch into main.


## Getting Started and creating a feature branch

1. **Clone the repository**: Run the following command to clone the repository to your local machine:
   ```sh
   git clone https://github.com/your-username/repository-name.git
   ```
   **Note**: for public repositories where you are not a member, you need to first create a
   "fork" of the repository to your own GitHub account before you can clone a local copy. To do this,
   click the "Fork" button at the top right of the repository page in the GitHub web
   interface to create your own copy. You will be able to push changes directly to your fork but
   not to the original repository. To suggest changes to the original repository,
   you will have to submit your changes via pull requests which will need to then
   be approved by the maintainers of the original repository. This system protects
   public repositories from degenerating into chaos.

2. **Navigate to the project directory**:
On your local machine:
   ```sh
   cd repository-name
   ```

3. **Replicate the required python environment on your local machine** (only needed once)
```sh
conda env create --name env-test-repo --file=environment.yaml
```
This assumes that you have conda (or better mamba) installed. IF not, you need
to install that first.

4. **Activate the python environment**
```sh
conda activate env-test-repo
```

5. **Create a feature branch**:
Always create a new branch for your work. Do ***not*** commit directly to ```main```.
   ```sh
   git checkout -b feature/<short-description>
   ```
Often a feature will be associated with a particular issues listed in the "Issues" tab on GitHub.
It is helpful to include the corresponding issue number in your feature branch name.
For example if the issue number is 123 and requires adding a plot of f(x), you could name your
feature branch as follows:
  ```sh
   git checkout -b feature/feat-123-add_fx_plot
   ```

6. **Make changes and commit**:
Suppose you change the code in ```src/file1.py``` and ```docs/file3.py``` and the contents of the ```environment.yaml``` file.
   ```sh
   git add environment.yaml src/file1.opy docs/file3.py
   git commit -m "Describe your change clearly"
   ```

7.  **Push your branch to the remote repository**

At this point, your changes will be committed to your local copy of the repository.
To transfer them to the remote copy of the repository, you create a copy of your local feature branch on the remote repository:
```sh
git push -u origin feature/<short-description>
```
where ```feature/<short-description>``` is the name you gave to your local feature branch in step 5 above.

## Keeping up-to-date

### Keep you local copy of ```main``` up-to-date

When creating a new feature branch from your local ```main``` branch (as in step 5 above) you need to make sure that you are branching from the most up-to-date version of the ```main``` branch - i.e. that you include any changes that have been submitted to ```main``` since you last copied the remote repo.
To do this, you should periodically run:
```sh
git checkout main
git pull
```

### Keep the shared python environment up-to-date

If add new packages while working on a feature, add the corresponding packages to the ```environment.yaml``` file and commit this file along with your changes.

If your local python environment is missing some packages that have been added by someone else, you will need to update your conda environment from the latest```environment.yaml``` file:

``` sh
conda env update --file environment.yml --prune
```



## Creating a Pull Request

A pull request is a request to merge the changes you have made and tested in
your local feature branch back into the remote main branch. Before you start, make
sure you are on your local feature branch.

1. Rebase your local feature branch on the most recent main:
```
git fetch origin
git rebase origin/main
```
2. Locally resolve any conflicts which are generated by the rebase operation,
using ```git rebase --continue``` to proceed after each conflicting commit has
been fixed. Roughly, the process is the following:
    1. ```git status``` → See what’s broken

    2. Open each conflicted file

    3. Remove conflict markers and fix code

    4. ```git add <file>```

    5. ```git rebase --continue```

    6. Repeat until done

3. When all conflicts have been resolved and your code has been tested. Push your
local feature branch to the remote repository. Usually after rebasing, you will
need to do a forced push:
```
git push --force-with-lease
```
***Note:*** : forced push is only safe for a feature branch which is entirely your own. Never do a forced push to a shared branch.

4. Go to the original repository on GitHub.

5. Click on "Pull Requests" and then "New Pull Request."

6. Select your fork and branch, andi choose to "compare" it with the `main` branch of the original repository.

7. Add a title and description for your changes.

8. Click "Create Pull Request."

***Some extra links***:
- For some discussion of how conflicts are handled during rebase operations see [here](https://learning-ocean.com/tutorials/git/git-rebase-conflict-resolution/)
- For more information about git merge conflicts in general see [here](https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/addressing-merge-conflicts/about-merge-conflicts)
- For more information about how to resolve merge conflicts using the command line see [here](https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/addressing-merge-conflicts/resolving-a-merge-conflict-using-the-command-line)

## Merging Changes

1. Wait for a review from a maintainer.
2. Address any requested changes.
3. Once approved, a maintainer will merge the pull request. If you have properly
rebased you feature branch on main, this process should not produce any conflicts.
4. After merging, **sync your local repository**:
   ```sh
   git checkout main
   git pull origin main
   ```

## Code Style and Best Practices
- Follow the project's coding style and guidelines. We don't have any yet. Ideas?
- Try to commit often and in an "atomic" way with each change corresponding to one commit. It is much easier to resolve merge conflicts when each commit has a clear purpose. Combining lots of unrelated changes into a single commit can result in very complex merge conflicts.
- Write meaningful commit messages.
- Keep pull requests focused and concise.
- Ensure all tests pass before submitting a PR. We haven't got any yet.
